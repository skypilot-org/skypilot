# This task creates a pod with low ephemeral storage limits that will
# intentionally exceed the limit and get evicted. Used to test that
# SkyPilot correctly handles pods with terminated containers where
# finishedAt is null.

resources:
  infra: kubernetes

config:
  kubernetes:
    pod_config:
      spec:
        containers:
          - name: ray-node
            resources:
              requests:
                ephemeral-storage: "100Mi"
              limits:
                ephemeral-storage: "500Mi"

run: |
  i=0
  while true; do
    dd if=/dev/zero of=/tmp/fill-$i bs=10M count=10 2>/dev/null
    i=$((i+1))
    sleep 0.5
  done
