service:
  readiness_probe:
    path: /health
    initial_delay_seconds: 3600  # Large delay to allow time for image pulling
  replicas: 1

resources:
  image_id: docker:python:3.11  # Use a medium-sized image (~390MB) that will generate spinner updates during pull
  infra: kubernetes
  ports: 8000

run: |
  set -euo pipefail
  # Simple HTTP server that responds to /health
  python3 << 'EOF'
  from http.server import HTTPServer, BaseHTTPRequestHandler

  class Handler(BaseHTTPRequestHandler):
      def do_GET(self):
          self.send_response(200)
          self.end_headers()
          if self.path == '/health':
              self.wfile.write(b'OK')
          else:
              self.wfile.write(b'Hi')

  HTTPServer(('0.0.0.0', 8000), Handler).serve_forever()
  EOF
