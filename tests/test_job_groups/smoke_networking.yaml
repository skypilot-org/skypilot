# JobGroup networking smoke test - verifies cross-job hostname resolution
---
name: {{name}}
execution: parallel
---
name: server
resources:
  cpus: 2
  infra: {{cloud}}
run: |
  echo "Server starting"
  python3 -m http.server 8080 &
  SERVER_PID=$!
  sleep 60
  kill $SERVER_PID 2>/dev/null || true
  echo "Server done"
---
name: client
resources:
  cpus: 2
  infra: {{cloud}}
run: |
  echo "Client starting"
  sleep 10
  SERVER_HOST="server-0.${SKYPILOT_JOBGROUP_NAME}"
  echo "Testing connection to $SERVER_HOST"
  for i in $(seq 1 10); do
    if curl -s --connect-timeout 5 http://$SERVER_HOST:8080/ > /dev/null 2>&1; then
      echo "SUCCESS: Connected to server"
      exit 0
    fi
    echo "Attempt $i failed, retrying..."
    sleep 3
  done
  echo "FAILED: Could not connect to server"
  exit 1
