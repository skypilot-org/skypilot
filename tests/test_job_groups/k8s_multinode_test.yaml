---
name: k8s-multinode-group
placement: SAME_INFRA
execution: parallel
---
name: workers
resources:
  cpus: 2
  infra: kubernetes
num_nodes: 2
run: |
  echo "Worker node $(hostname) starting"
  echo "SKYPILOT_NUM_NODES: ${SKYPILOT_NUM_NODES}"
  echo "SKYPILOT_NODE_RANK: ${SKYPILOT_NODE_RANK}"
  echo "JobGroup: ${SKYPILOT_JOBGROUP_NAME}"
  sleep 20
  echo "Worker node done"
---
name: coordinator
resources:
  cpus: 2
  infra: kubernetes
run: |
  echo "Coordinator starting"
  echo "JobGroup: ${SKYPILOT_JOBGROUP_NAME}"

  # Wait for workers to be ready
  sleep 5

  # Check if we can reach worker nodes
  echo "Checking worker nodes..."
  for i in 0 1; do
    WORKER_HOST="workers-$i.${SKYPILOT_JOBGROUP_NAME}"
    echo "Checking $WORKER_HOST..."
    ping -c 1 $WORKER_HOST 2>/dev/null && echo "  Reachable" || echo "  Not reachable"
  done

  sleep 15
  echo "Coordinator done"
