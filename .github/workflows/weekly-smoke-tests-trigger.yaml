name: Weekly Smoke Tests Trigger

on:
  schedule:
    - cron: '0 0 * * 0'  # Runs at 00:00 on Sunday (UTC)

jobs:
  smoke-tests:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        cloud: [aws, azure, gcp, kubernetes]
    steps:
      - name: Trigger Smoke Tests (${{ matrix.cloud }})
        env:
          BUILDKITE_TOKEN: ${{ secrets.BUILDKITE_TOKEN }}
          BUILDKITE_API_URL: "https://api.buildkite.com/v2/organizations/skypilot-1/pipelines/smoke-tests/builds"
        run: |
          curl -H "Authorization: Bearer $BUILDKITE_TOKEN" \
            -X POST "$BUILDKITE_API_URL" \
            -d '{
              "commit": "HEAD",
              "branch": "master",
              "message": "Weekly Smoke Tests on (${{ matrix.cloud }})",
              "env": {
                "ARGS": "--${{ matrix.cloud }}"
              }
            }'
