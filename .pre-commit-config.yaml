# Ensure this configuration aligns with format.sh and requirements-dev.txt
repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: check-yaml
        exclude: ^charts/
    -   id: check-added-large-files

# Black for IBM-specific code only
-   repo: https://github.com/psf/black
    rev: 22.10.0  # Match the version from requirements-dev.txt
    hooks:
    -   id: black
        name: black (IBM specific)
        files: "^sky/skylet/providers/ibm/.*"

# Ruff - replaces yapf, isort, and pylint (10-100x faster)
-   repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.9.6  # Match the version from requirements-dev.txt
    hooks:
    # Ruff linter (replaces pylint, isort sorting)
    -   id: ruff
        name: ruff lint
        args: [--fix]
        exclude: (^sky/skylet/providers/ibm/|^sky/schemas/generated/)
    # Ruff formatter (replaces yapf)
    -   id: ruff-format
        name: ruff format
        exclude: (^sky/skylet/providers/ibm/|^sky/schemas/generated/)

# mypy for type checking (cannot be replaced by Ruff)
-   repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.1  # Match the version from requirements-dev.txt
    hooks:
    -   id: mypy
        args:
            # From tests/mypy_files.txt
            - "sky"
            - "--exclude"
            - "sky/benchmark|sky/callbacks|sky/backends/monkey_patches"
            - "--cache-dir"
            - "/dev/null"
            - "--check-untyped-defs"
        pass_filenames: false
        additional_dependencies:
            - types-aiofiles
            - types-PyYAML
            - types-requests<2.31  # Match the condition in requirements-dev.txt
            - types-setuptools<80.9  # Match the condition in requirements-dev.txt
            - types-cachetools
            - types-pyvmomi
            - types-paramiko
            - types-protobuf
            - types-python-dateutil

-   repo: https://github.com/gruntwork-io/pre-commit
    rev: v0.1.30
    hooks:
    -   id: helmlint

-   repo: local
    hooks:
    -   id: dashboard-lint
        name: dashboard lint
        entry: bash -c 'cd sky/dashboard && npm run lint'
        language: node
        language_version: 24.12.0
        files: ^sky/dashboard/
        pass_filenames: false

    -   id: dashboard-format
        name: dashboard format
        entry: bash -c 'cd sky/dashboard && npm run format'
        language: node
        language_version: 24.12.0
        files: ^sky/dashboard/
        pass_filenames: false
