# Ray cluster config template for Hyperbolic Cloud

# NOTE: Before launching, ensure your SSH public key is added in the Hyperbolic web app.

cluster_name: {{cluster_name_on_cloud}}

# Hyperbolic only supports a single node (the head node).
max_workers: 0
upscaling_speed: 0
idle_timeout_minutes: 60

provider:
  type: external
  module: sky.provision.hyperbolic
  region: "default"

auth:
  ssh_user: root
  ssh_private_key: {{ssh_private_key}}

available_node_types:
  ray_head_default:
    resources: {}
    node_config:
      InstanceType: "{{instance_type}}"
      # Extract GPU configuration from instance type
      # Format: 1x-T4-4-17 -> gpu_count=1, gpu_model=Tesla-T4
      GPUCount: {{instance_type.split('-')[0].replace('x', '')}}
      GPUModel: {{instance_type.split('-')[1].upper()}}
      # No AuthorizedKey field: SSH public key must be added in Hyperbolic app

head_node_type: ray_head_default

# Format: `REMOTE_PATH : LOCAL_PATH`
file_mounts: {
  "{{sky_ray_yaml_remote_path}}": "{{sky_ray_yaml_local_path}}",
  "{{sky_remote_path}}/{{sky_wheel_hash}}": "{{sky_local_path}}",
{%- for remote_path, local_path in credentials.items() %}
  "{{remote_path}}": "{{local_path}}",
  "~/.ssh/sky-cluster-key": "{{ssh_private_key}}",
{%- endfor %}
}

rsync_exclude: []

initialization_commands: []

# List of shell commands to run to set up nodes.
# NOTE: these are very performance-sensitive. Each new item opens/closes an SSH
# connection, which is expensive. Try your best to co-locate commands into fewer
# items!
#
# Increment the following for catching performance bugs easier:
#   current num items (num SSH connections): 1

# Add more fields as needed for your cloud
