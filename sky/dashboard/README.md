This is a [Next.js](https://nextjs.org/) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

### Access the dashboard

If you install SkyPilot from the official package, after starting the API server, the dashboard can be accessed at `${API_Server_Endpoint}/dashboard`, for example, it's `http://127.0.0.1:46580/dashboard` for the local API server by default.

If you install SkyPilot from source, before starting the API server, run the following commands to generate the dashboard production build:

1. Install node js and npm:

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
nvm install 18
nvm use 18
```

```bash
# You may need to clear your cache if you have permission issues
# npm cache clean --force

# Install all dependencies in the current directory
npm install
# Build
npm run build
```

Then you can start your API server and access the dashboard at `${API_Server_Endpoint}/dashboard`.

### Run dashboard development server

If you want to update the dashboard files or debug the dashboard, you can run the development server following the instructions.

Install dependencies:

```bash
# You may need to clear your cache if you have permission issues
# npm cache clean --force

# Install all dependencies in the current directory
npm install
```

By default, the dashboard will connect to your local API server at `http://127.0.0.1:46580`. If you want to connect to another API server, set the environment variable:

```bash
export SKYPILOT_API_SERVER_ENDPOINT=http://username:password@skypilot-api.domain.com:30050
```

Run the development server:

```bash
npm run dev
```

Open [http://localhost:3000/dashboard](http://localhost:3000/dashboard) with your browser to see the result.

You can start editing the page by modifying the files. The page auto-updates as you edit the file.

Execute `npm run lint` for static code analysis and `npm run format` to format the code with `prettier`.


## Dashboard Plugin Mechanism

The dashboard mirrors the backend plugin system. After the initial render it calls `GET /api/v1/plugins` (via the `/internal/dashboard` prefix) to discover backend plugins. Each plugin can optionally include a `js_path` in the response; those scripts are then fetched asynchronously so they do not block the first paint. Missing scripts (e.g. `404`) are logged and ignored so clusters without UI plugins continue to work without noise.

The script, once loaded, can talk to the dashboard through the global `window.SkyDashboardPluginAPI`. The API currently exposes two capabilities:

- `registerTopNavLink({ id, label, href, order?, target?, external?, icon?, badge? })`: adds or replaces a navigation link in the desktop top bar and its mobile equivalent. Links use the existing SkyPilot styling. Use `order` (default `0`) to control the insertion order; smaller numbers are rendered first. Links that set `target: '_blank'` (or `external: true`) open in a new tab.
- `getContext()`: returns `{ basePath, apiEndpoint }`, which equals the values used by the dashboard when calling the SkyPilot API server. This is useful for plugins that need to reference API endpoints or static assets hosted by SkyPilot.

### Backend plugin metadata

Backend plugins are loaded via `sky/server/plugins.py`. To expose a frontend extension, return metadata from the plugin initializer:

```python
def init_plugin(app):
    # configure the backend...
    return {
        'name': 'observability',
        'description': 'Adds observability dashboards',
        'js_path': '/plugin-ui/observability.js',  # None if no frontend
    }
```

The dashboard will asynchronously load the referenced JS bundle.

### Frontend plugin example

```js
(function () {
  const api = window.SkyDashboardPluginAPI;
  if (!api) return;

  const { apiEndpoint } = api.getContext();
  api.registerTopNavLink({
    id: 'observability',
    label: 'Observability',
    href: `${apiEndpoint}/plugins/observability`,
    order: 20,
    target: '_blank',
    badge: 'beta',
  });
})();
```

Because the plugin bundle is regular JavaScript served by the SkyPilot API server, it can be generated by backend plugins (see `sky/server/plugins.py`) or any other mechanism that writes to the path returned in the plugin metadata (for example `/plugin-ui/observability.js`).
