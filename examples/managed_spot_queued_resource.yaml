name: minimal

resources:
  use_spot: true
  infra: gcp/us-central1/us-central1-a
  accelerators: tpu-v5litepod-16:1
  accelerator_args:
    runtime_version: v2-alpha-tpuv5-lite
    gcp_queued_resource: true
    # Optional: Set how long the queued resource request remains valid.
    # SkyPilot's polling timeout will align with this value.
    # Use ONE of the following (not both):
    #
    # Option 1: Duration in seconds (e.g., 10800 = 3 hours)
    # valid_until_duration: 10800
    #
    # Option 2: Absolute timestamp in RFC 3339 format
    # valid_until_time: "2024-12-31T23:59:59Z"
    #
    # Default timeout is 6000 seconds (100 minutes) if neither is specified.

setup: |
  echo "running setup"
  pip install tqdm
  pip install jax[tpu]

run: |
  conda env list
  python -u - << EOF
  import time
  import tqdm
  import jax
  print(jax.devices())

  for i in tqdm.trange(240):
    time.sleep(1)

  EOF
