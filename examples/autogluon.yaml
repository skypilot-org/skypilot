resources:
  infra: gcp

setup: |
  git clone https://github.com/autogluon/autogluon.git

  if [ ! -d ~/autogluon-venv ]; then
    uv venv ~/autogluon-venv --python 3.8
    source ~/autogluon-venv/bin/activate
    pip install torch==1.13.1+cpu torchvision==0.14.1+cpu -f https://download.pytorch.org/whl/cpu/torch_stable.html
    pip install autogluon
    # Ray + Torch Dataloader failed with latest grpcio
    # See: https://github.com/ray-project/ray/pull/33903
    pip install grpcio==1.51.3
  else
    source ~/autogluon-venv/bin/activate
  fi

run: |
  source ~/autogluon-venv/bin/activate
  cd autogluon
  python examples/automm/tabular_dl/example_tabular.py --mode single_hpo
