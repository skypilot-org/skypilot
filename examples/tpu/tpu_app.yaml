name: tpu_app

# The working directory contains all code and will be synced to remote.
workdir: ./examples/tpu/tpu_app_code

resources:
  accelerators: tpu-v2-8

# The setup command.  Will be run under the working directory.
setup: |
  pip install --upgrade pip

  if [ ! -d ~/huggingface ]; then
    uv venv ~/huggingface --python 3.8
    source ~/huggingface/bin/activate
    pip install -r requirements.txt
  else
    source ~/huggingface/bin/activate
  fi

# The command to run.  Will be run under the working directory.
run: |
  source ~/huggingface/bin/activate
  python -u run_tpu.py
