name: resnet-distributed-app


resources:
    cloud: aws
    accelerators:
        V100: 1

num_nodes: 2

setup: |
    pip3 install --upgrade pip
    git clone https://github.com/michaelzhiluo/pytorch-distributed-resnet
    cd pytorch-distributed-resnet && pip3 install -r requirements.txt
    mkdir -p data  && mkdir -p saved_models && cd data && \
    wget -c --quiet https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz
    tar -xvzf cifar-10-python.tar.gz

run: |
    cd pytorch-distributed-resnet
    python3 -m torch.distributed.launch --nproc_per_node=1 \
    --nnodes=2 --node_rank=${SKY_NODE_ID} --master_addr=${SKY_NODE_IPS[0]} \
    --master_port=8008 resnet_ddp.py --num_epochs 20
